---
const {titre, type, url, thumbnail} = Astro.props;
---
<script hoist>
function playSound(event) {
  event.target.getElementsByTagName('audio')[0].play();
}

function handlePause(event) {
  // c'est degeu lol
  event.target.parentNode.parentNode.parentNode.classList.remove('ring-1')
}

function handlePlay(event, isSound) {
  if(isSound) {
    event.target.parentNode.parentNode.parentNode.classList.add('ring-1')
  }

  const media = document.body.querySelectorAll('audio, video')
  for (var i = 0; i < media.length; i++) {
    if(media[i] !== event.target) {
      media[i].pause();
    }
  };
}
</script>

{
  type === "video" &&
  <div class="aspect-w-16 aspect-h-9 ring-1 ring-accent ring-offset-2 ring-offset-accent-focus">
    <video
      poster={thumbnail}
      controls
      onplay="handlePlay(event)"
      preload="none"
      volume="0.75">
      <!-- Safari still needs mp4... -->
      <source src={`${url}.mp4`} type="video/mp4">
      <source src={`${url}.webm`} type="video/webm">
    </video>
  </div>
}
{
  !type &&
  <div class="card w-96 bg-base-200 shadow-xl ring-accent overflow-visible" onclick="playSound(event)">
    <div class="card-body">
      <h2 class="card-title">{titre}</h2>
      <figure>
        <audio
          controls
          preload="none"
          volume="0.75"
          onplay="handlePlay(event, true)"
          onpause="handlePause(event)"
        >
          <source src={`${url}.mp3`} type="audio/mpeg">
          <source src={`${url}.ogg`} type="audio/ogg">
        </audio>
      <a class="tooltip tooltip-primary ml-2 justify-end z-10" href={`${url}.mp3`} download data-tip={`Télécharger ${titre}`}>
        <button class="btn btn-square btn-outline">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
          </svg>
        </button>
      </a>
      </figure>

    </div>
  </div>
}
